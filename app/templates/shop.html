{% extends 'base.html' %} {% block title %}Shop{% endblock %} {% block head %}
<link
  rel="stylesheet"
  href="{{ url_for('static', filename='styles/shop.css') }}"
/>
{% endblock %} {% block content %}
<div class="shop-container">
  <div class="product-carousel">
    <div class="carousel-container">
      <!-- Slide 1 -->
      <div class="carousel-slide active" data-slide="0">
        <div class="product-image">
          <img
            src="{{ url_for('static', filename='images/Green Apple & Vanille.jpg') }}"
            alt="Lavender Premium Soap"
          />
        </div>
        <div class="product-info">
          <h1>Green Apple & Vanille</h1>
          <p>
            Handgefertigt mit echten Lavendelblüten und ätherischen Ölen.
            Entspannen Sie Ihre Sinne bei jeder Wäsche.
          </p>
          <button
            class="buy-btn"
            onclick="carouselBuyNow('Green Apple & Vanille', 12.99)"
          >
            Jetzt kaufen
          </button>
        </div>
      </div>

      <!-- Slide 2 -->
      <div class="carousel-slide" data-slide="1">
        <div class="product-image">
          <img
            src="{{ url_for('static', filename='images/Green Apple & Lemon & Vanille Mix.jpg') }}"
            alt="Rose Premium Soap"
          />
        </div>
        <div class="product-info">
          <h1>Rosen Garten Seife</h1>
          <p>
            Mit Rosenblättern und natürlichen Feuchtigkeitsspendern infundiert.
            Erleben Sie täglich Luxus-Hautpflege.
          </p>
          <button
            class="buy-btn"
            onclick="carouselBuyNow('Rosen Garten Seife', 13.99)"
          >
            Jetzt kaufen
          </button>
        </div>
      </div>

      <!-- Slide 3 -->
      <div class="carousel-slide" data-slide="2">
        <div class="product-image">
          <img
            src="{{ url_for('static', filename='images/SeifeFloravis.jpg') }}"
            alt="Honey Premium Soap"
          />
        </div>
        <div class="product-info">
          <h1>Honig Glühende Seife</h1>
          <p>
            Hergestellt mit organisches Honig und Haferflocken. Nähren und
            erweichen Sie Ihre Haut auf natürliche Weise.
          </p>
          <button
            class="buy-btn"
            onclick="carouselBuyNow('Honig Glühende Seife', 12.49)"
          >
            Jetzt kaufen
          </button>
        </div>
      </div>
    </div>

    <!-- Navigation Arrows -->
    <div class="carousel-navigation">
      <button class="carousel-arrow prev" onclick="changeSlide(-1)">
        <i class="fa fa-chevron-left"></i>
      </button>
      <div class="carousel-dots">
        <span class="dot active" onclick="goToSlide(0)"></span>
        <span class="dot" onclick="goToSlide(1)"></span>
        <span class="dot" onclick="goToSlide(2)"></span>
      </div>
      <button class="carousel-arrow next" onclick="changeSlide(1)">
        <i class="fa fa-chevron-right"></i>
      </button>
    </div>
  </div>

  <section class="products-section">
    <h2>Unsere Seifen</h2>

    <!-- Category Filter -->
    <div class="category-filter">
      <a
        href="{{ url_for('shop') }}"
        class="filter-btn {% if not category %}active{% endif %}"
        >Alle</a
      >
      <a
        href="{{ url_for('shop', category='classic') }}"
        class="filter-btn {% if category == 'classic' %}active{% endif %}"
        >Klassisch</a
      >
      <a
        href="{{ url_for('shop', category='luxury') }}"
        class="filter-btn {% if category == 'luxury' %}active{% endif %}"
        >Luxus</a
      >
    </div>

    <div class="products-grid">
      <div class="product-card">
        <img
          src="{{ url_for('static', filename='images/Green Apple & Lemon mix.jpg') }}"
          alt="Green Apple & Lemon"
        />
        <h3>Green Apple & Lemon mix</h3>
        <p class="price">12.99 CHF</p>
        <div class="pack-selector">
          <div class="pack-btn-wrapper">
            <button class="pack-btn active" data-quantity="1" data-discount="0">
              1
            </button>
          </div>
          <div class="pack-btn-wrapper">
            <span class="discount-badge">-10%</span>
            <button class="pack-btn" data-quantity="2" data-discount="10">
              2
            </button>
          </div>
          <div class="pack-btn-wrapper">
            <span class="discount-badge">-20%</span>
            <button class="pack-btn" data-quantity="3" data-discount="20">
              3
            </button>
          </div>
        </div>
        <button class="add-to-cart-btn">In den Warenkorb</button>
      </div>

      <div class="product-card">
        <img
          src="{{ url_for('static', filename='images/Green Apple & Lemon & Vanille Mix.jpg') }}"
          alt="Green Apple & Lemon & Vanille Mix"
        />
        <h3>Green Apple & Lemon & Vanille Mix</h3>
        <p class="price">13.99 CHF</p>
        <div class="pack-selector">
          <div class="pack-btn-wrapper">
            <button class="pack-btn active" data-quantity="1" data-discount="0">
              1
            </button>
          </div>
          <div class="pack-btn-wrapper">
            <span class="discount-badge">-10%</span>
            <button class="pack-btn" data-quantity="2" data-discount="10">
              2
            </button>
          </div>
          <div class="pack-btn-wrapper">
            <span class="discount-badge">-20%</span>
            <button class="pack-btn" data-quantity="3" data-discount="20">
              3
            </button>
          </div>
        </div>
        <button class="add-to-cart-btn">In den Warenkorb</button>
      </div>

      <div class="product-card">
        <img
          src="{{ url_for('static', filename='images/Green Apple & Lemon with Stamp.jpg') }}"
          alt="Green Apple & Lemon with Stamp"
        />
        <h3>Green Apple & Lemon with Stamp</h3>
        <p class="price">14.99 CHF</p>
        <div class="pack-selector">
          <div class="pack-btn-wrapper">
            <button class="pack-btn active" data-quantity="1" data-discount="0">
              1
            </button>
          </div>
          <div class="pack-btn-wrapper">
            <span class="discount-badge">-10%</span>
            <button class="pack-btn" data-quantity="2" data-discount="10">
              2
            </button>
          </div>
          <div class="pack-btn-wrapper">
            <span class="discount-badge">-20%</span>
            <button class="pack-btn" data-quantity="3" data-discount="20">
              3
            </button>
          </div>
        </div>
        <button class="add-to-cart-btn">In den Warenkorb</button>
      </div>

      <div class="product-card">
        <img
          src="{{ url_for('static', filename='images/Green Apple & Lemon.jpg') }}"
          alt="Green Apple & Lemon"
        />
        <h3>Green Apple & Lemon</h3>
        <p class="price">11.99 CHF</p>
        <div class="pack-selector">
          <div class="pack-btn-wrapper">
            <button class="pack-btn active" data-quantity="1" data-discount="0">
              1
            </button>
          </div>
          <div class="pack-btn-wrapper">
            <span class="discount-badge">-10%</span>
            <button class="pack-btn" data-quantity="2" data-discount="10">
              2
            </button>
          </div>
          <div class="pack-btn-wrapper">
            <span class="discount-badge">-20%</span>
            <button class="pack-btn" data-quantity="3" data-discount="20">
              3
            </button>
          </div>
        </div>
        <button class="add-to-cart-btn">In den Warenkorb</button>
      </div>

      <div class="product-card">
        <img
          src="{{ url_for('static', filename='images/Green Apple & Vanille.jpg') }}"
          alt="Green Apple & Vanille"
        />
        <h3>Green Apple & Vanille</h3>
        <p class="price">12.49 CHF</p>
        <div class="pack-selector">
          <div class="pack-btn-wrapper">
            <button class="pack-btn active" data-quantity="1" data-discount="0">
              1
            </button>
          </div>
          <div class="pack-btn-wrapper">
            <span class="discount-badge">-10%</span>
            <button class="pack-btn" data-quantity="2" data-discount="10">
              2
            </button>
          </div>
          <div class="pack-btn-wrapper">
            <span class="discount-badge">-20%</span>
            <button class="pack-btn" data-quantity="3" data-discount="20">
              3
            </button>
          </div>
        </div>
        <button class="add-to-cart-btn">In den Warenkorb</button>
      </div>

      <div class="product-card">
        <img
          src="{{ url_for('static', filename='images/GreenAppleVanille.jpg') }}"
          alt="Green Apple & Vanille"
        />
        <h3>Green Apple & Vanille</h3>
        <p class="price">13.49 CHF</p>
        <div class="pack-selector">
          <div class="pack-btn-wrapper">
            <button class="pack-btn active" data-quantity="1" data-discount="0">
              1
            </button>
          </div>
          <div class="pack-btn-wrapper">
            <span class="discount-badge">-10%</span>
            <button class="pack-btn" data-quantity="2" data-discount="10">
              2
            </button>
          </div>
          <div class="pack-btn-wrapper">
            <span class="discount-badge">-20%</span>
            <button class="pack-btn" data-quantity="3" data-discount="20">
              3
            </button>
          </div>
        </div>
        <button class="add-to-cart-btn">In den Warenkorb</button>
      </div>
    </div>
  </section>
</div>

<script>
  // Carousel functionality
  let currentSlide = 0;
  const totalSlides = 3;

  function changeSlide(direction) {
    currentSlide += direction;
    if (currentSlide >= totalSlides) currentSlide = 0;
    if (currentSlide < 0) currentSlide = totalSlides - 1;
    updateCarousel();
  }

  function goToSlide(slideIndex) {
    currentSlide = slideIndex;
    updateCarousel();
  }

  function updateCarousel() {
    // Update slides
    document.querySelectorAll(".carousel-slide").forEach((slide, index) => {
      slide.classList.remove("active");
      if (index === currentSlide) {
        slide.classList.add("active");
      }
    });

    // Update dots
    document.querySelectorAll(".carousel-dots .dot").forEach((dot, index) => {
      dot.classList.remove("active");
      if (index === currentSlide) {
        dot.classList.add("active");
      }
    });
  }

  // Handle pack selection buttons
  document.querySelectorAll(".pack-btn").forEach((btn) => {
    btn.addEventListener("click", function () {
      // Get the product card and original price
      const productCard = this.closest(".product-card");
      const priceElement = productCard.querySelector(".price");
      const priceText =
        priceElement.getAttribute("data-original-price") ||
        priceElement.textContent;

      // Store original price if not already stored
      if (!priceElement.getAttribute("data-original-price")) {
        priceElement.setAttribute("data-original-price", priceText);
      }

      // Get the quantity from data attribute
      const quantity = parseInt(this.getAttribute("data-quantity"));

      // Extract base price (remove "CHF" and parse as float)
      const basePrice = parseFloat(
        priceText.replace(" CHF", "").replace(",", "."),
      );

      // Calculate new price with discounts
      let newPrice = basePrice * quantity;
      if (quantity === 2) {
        newPrice = newPrice * 0.9; // 10% discount
      } else if (quantity === 3) {
        newPrice = newPrice * 0.8; // 20% discount
      }

      // Round to .99
      newPrice = Math.floor(newPrice) + 0.99;

      // Update the price display
      priceElement.textContent = newPrice.toFixed(2) + " CHF";

      // Remove active class from all pack buttons in this selector
      this.closest(".pack-selector")
        .querySelectorAll(".pack-btn")
        .forEach((sibling) => {
          sibling.classList.remove("active");
        });
      // Add active class to clicked button
      this.classList.add("active");
    });
  });

  // Handle add to cart buttons
  document.querySelectorAll(".add-to-cart-btn").forEach((btn) => {
    btn.addEventListener("click", function () {
      const productCard = this.closest(".product-card");
      const productName = productCard.querySelector("h3").textContent;
      const priceElement = productCard.querySelector(".price");

      // Get the original base price (not the discounted displayed price)
      const originalPriceText =
        priceElement.getAttribute("data-original-price") ||
        priceElement.textContent;
      const basePrice = parseFloat(
        originalPriceText.replace(" CHF", "").replace(",", "."),
      );

      const quantityBtn = productCard.querySelector(".pack-btn.active");
      const quantity = parseInt(quantityBtn.getAttribute("data-quantity")) || 1;

      // Call the global addToCart function from base.html with the base price
      addToCart(productName, quantity, basePrice);
    });
  });

  // Handle carousel buy now buttons
  function carouselBuyNow(productName, price) {
    addToCart(productName, 1, price); // In der add-to-cart-btn Event Listener Funktion
    document.querySelectorAll(".add-to-cart-btn").forEach((btn) => {
      btn.addEventListener("click", function () {
        const productCard = this.closest(".product-card");
        const productName = productCard.querySelector("h3").textContent;

        addToCart(productName, quantity, basePrice);
      });
    });
  }
</script>

{% endblock %}
