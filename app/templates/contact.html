{% extends 'base.html' %} {% block title %}Kontakt & Support | Flor'Avis{%
endblock %} {% block head %}
<link
  href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
  rel="stylesheet"
/>
<link
  href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@1,400;1,600&display=swap"
  rel="stylesheet"
/>

<link
  rel="stylesheet"
  href="{{ url_for('static', filename='styles/contact.css') }}"
/>
{% endblock %} {% block content %}
<div class="contact-wrapper">
  <div class="contact-hero">
    <h1>Kontaktieren Sie uns</h1>
    <p class="hero-subtitle">
      Wir würden gerne von Ihnen hören. Senden Sie uns eine Nachricht und wir
      antworten Ihnen so bald wie möglich.
    </p>
  </div>
    <div class="contact-container">
        <!-- Contact Form -->
        <div class="form-section">
            <form method="post">
                <div class="form-grid">
                    <div class="input-group">
                        <label for="firstname">
                            <i class="fa fa-user"></i>
                            Vorname
                        </label>
                        <input type="text" id="firstname" name="firstname" placeholder="Geben Sie Ihren Vornamen ein" required>
                        <span class="input-border"></span>
                    </div>
                    <div class="input-group">
                        <label for="lastname">
                            <i class="fa fa-user"></i>
                            Nachname
                        </label>
                        <input type="text" id="lastname" name="lastname" placeholder="Geben Sie Ihren Nachnamen ein" required>
                        <span class="input-border"></span>
                    </div>
                </div>
                <div class="input-group">
                    <label for="email">
                        <i class="fa fa-envelope"></i>
                        Email Addresse
                    </label>
                    <input type="email" id="email" name="email" placeholder="ihre.email@beispiel.com" required>
                    <span class="input-border"></span>
                </div>
                <div class="input-group">
                    <label for="message">
                        <i class="fa fa-comment"></i>
                        Ihre Nachricht
                    </label>
                    <textarea id="message" name="message" rows="6" placeholder="Erzählen Sie uns, wie wir Ihnen helfen können..." maxlength="500" required></textarea>
                    <span class="input-border"></span>
                    <div class="char-counter">
                        <span id="char-count">0</span>/500 characters
                    </div>
                </div>
                <button type="submit" id="absenden-btn" class="submit-btn">
                    Nachricht senden
                </button>
            </form>
        </div>

  <!-- Push Benachrichtigung für Erfolg -->
  <div id="notification" class="notification success-notification">
    <i class="fa fa-check-circle"></i>
    <div class="notification-content">
      <h4>Erfolg!</h4>
      <p>
        Vielen Dank für Ihre Nachricht! Wir werden Sie so bald wie möglich
        kontaktieren.
      </p>
    </div>
  </div>

  <!-- Push Benachrichtigung für Fehler -->
  <div id="error-notification" class="notification error-notification">
    <i class="fa fa-exclamation-circle"></i>
    <div class="notification-content">
      <h4>Fehler</h4>
      <p id="error-text">Nicht alle Felder wurden ausgefüllt!</p>
    </div>
  </div>
</div>

<script>
  // Character counter for textarea
  const messageField = document.getElementById("message");
  const charCount = document.getElementById("char-count");

  messageField.addEventListener("input", function () {
    charCount.textContent = this.value.length;
  });

  // Add floating label effect
  const inputs = document.querySelectorAll("input, textarea");
  inputs.forEach((input) => {
    input.addEventListener("focus", function () {
      this.parentElement.classList.add("focused");
    });

    input.addEventListener("blur", function () {
      if (!this.value) {
        this.parentElement.classList.remove("focused");
      }
    });
  });

  // Validierungsfunktionen
  function validateName(name) {
    // Keine Zahlen erlaubt
    var regex = /^[a-zA-ZäöüÄÖÜéèêàâîïôûçß\s\-]+$/;
    return regex.test(name) && name.trim().length > 0;
  }

  function validateEmail(email) {
    // Muss @ enthalten
    var regex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    return regex.test(email);
  }

  function showError(message) {
    var errorNotification = document.getElementById("error-notification");
    var errorText = document.getElementById("error-text");
    errorText.textContent = message;
    errorNotification.classList.remove("hide");
    errorNotification.classList.add("show");

    if (errorTimeoutId !== null) {
      clearTimeout(errorTimeoutId);
    }

    errorTimeoutId = setTimeout(function () {
      errorNotification.classList.remove("show");
      errorNotification.classList.add("hide");
    }, 4000);
  }

  // Variable um den Timeout-Timer zu speichern
  var errorTimeoutId = null;

  /* Greift auf den Button mit der ID "absenden-btn" zu
           und reagiert auf einen Klick */
  document
    .getElementById("absenden-btn")
    .addEventListener("click", function (e) {
      // Verhindert das Standardverhalten (z. B. Formular wird neu geladen)
      e.preventDefault();

      var lastname = document.getElementById("lastname").value; // Liest den Wert aus dem Eingabefeld "lastname" (Nachname)
      var firstname = document.getElementById("firstname").value; // Liest den Wert aus dem Eingabefeld "firstname" (Vorname)
      var email = document.getElementById("email").value; // Liest den Wert aus dem Eingabefeld "email"
      var message = document.getElementById("message").value; // Liest den Wert aus dem Textfeld "message" (Nachricht)

      // Prüft, ob eines der Felder leer ist
      if (!lastname || !firstname || !email || !message) {
        showError("Nicht alle Felder wurden ausgefüllt!");
        return;
      }

      // Prüfe Nachname (keine Zahlen)
      if (!validateName(lastname)) {
        showError("Nachname darf keine Zahlen enthalten");
        return;
      }

      // Prüfe Vorname (keine Zahlen)
      if (!validateName(firstname)) {
        showError("Vorname darf keine Zahlen enthalten");
        return;
      }

      // Prüfe E-Mail (muss @ enthalten)
      if (!validateEmail(email)) {
        showError("E-Mail muss ein @ enthalten und gültig sein");
        return;
      }

      // Wenn alle Felder erfüllt sind, verstecke die Fehlermeldung
      var errorNotification = document.getElementById("error-notification");
      errorNotification.classList.remove("show");
      errorNotification.classList.add("hide");

      // Löscht den Timeout, falls vorhanden
      if (errorTimeoutId !== null) {
        clearTimeout(errorTimeoutId);
      }

      // Erstellt ein neues FormData-Objekt für die Übertragung
      var formData = new FormData();

      formData.append("lastname", lastname); // Fügt den Nachnamen hinzu
      formData.append("firstname", firstname); // Fügt den Vornamen hinzu
      formData.append("email", email); // Fügt die E-Mail-Adresse hinzu
      formData.append("message", message); // Fügt die Nachricht hinzu

      // Sendet die Daten per POST an die Server-Route "contact"
      fetch('{{ url_for("contact") }}', {
        method: "POST", // HTTP-Methode
        body: formData, // Formulardaten
      })
        .then(function (response) {
          if (response.ok) {
            // Leert die Felder nur bei Erfolg
            document.getElementById("lastname").value = ""; // Leert das Nachnamen-Feld
            document.getElementById("firstname").value = ""; // Leert das Vornamen-Feld
            document.getElementById("email").value = ""; // Leert das E-Mail-Feld
            document.getElementById("message").value = ""; // Leert das Nachrichten-Feld
            document.getElementById("char-count").textContent = "0"; // Reset character counter

            // Greift auf die Erfolgs-Benachrichtigung zu
            var notification = document.getElementById("notification");

            // Zeigt die Benachrichtigung an
            notification.classList.add("show");

            // Versteckt die Benachrichtigung nach 4 Sekunden
            setTimeout(function () {
              // Entfernt die Anzeige-Klasse
              notification.classList.remove("show");
              // Fügt die Verstecken-Klasse hinzu
              notification.classList.add("hide");
            }, 4000); // 4 Sekunden
          } else {
            console.error("Server-Fehler:", response.status);
            showError(
              "Ein Fehler ist aufgetreten. Bitte versuchen Sie es später erneut.",
            );
          }
        })
        .catch(function (error) {
          console.error("Network error:", error);
          showError("Netzwerkfehler. Bitte prüfen Sie Ihre Verbindung.");
        });
    });
</script>

{% endblock %}
