{% extends 'base.html' %}

{% block title %}Orders | Flor'Avis{% endblock %}

{% block head %}
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@1,400;1,600&display=swap" rel="stylesheet">

<link rel="stylesheet" href="{{ url_for('static', filename='styles/orders.css') }}">
{% endblock %}

{% block content %}
<div class="orders">
    <h1 id="title">Meine Bestellungen</h1>

    <!-- Orders Container -->
    <div class="orders-container" id="orders-container">
        <!-- Orders werden hier dynamisch eingefÃ¼gt -->
    </div>

    <!-- Empty State (wird angezeigt wenn keine Bestellungen vorhanden) -->
    <div class="empty-orders" id="empty-orders" style="display: none;">
        <div class="empty-orders-message">
            <span class="empty-orders-icon">ðŸ“¦</span>
            <h2>Noch keine Bestellungen</h2>
            <p>Sie haben noch keine Bestellungen aufgegeben. Beginnen Sie jetzt zu einkaufen!</p>
            <a href="{{ url_for('shop') }}" class="shop-button">
                Zum Shop gehen
                <span class="arrow">â†’</span>
            </a>
        </div>
    </div>
</div>

<script>
    // Funktion um Bestellungen zu laden
    function getUserOrders() {
        // Lade gespeicherte Orders aus sessionStorage (wird beim SchlieÃŸen gelÃ¶scht)
        const savedOrders = sessionStorage.getItem('userOrders');
        
        if (savedOrders) {
            return JSON.parse(savedOrders);
        }
        
        return []; // Keine Bestellungen
    }

    function formatDate(dateString) {
        const date = new Date(dateString);
        return date.toLocaleDateString('en-US', { 
            year: 'numeric', 
            month: 'long', 
            day: 'numeric' 
        });
    }

    function renderOrders() {
        const orders = getUserOrders();
        const container = document.getElementById('orders-container');
        const emptyState = document.getElementById('empty-orders');

        if (!orders || orders.length === 0) {
            // Keine Bestellungen vorhanden
            container.style.display = 'none';
            emptyState.style.display = 'flex';
            return;
        }

        // Bestellungen vorhanden
        container.style.display = 'block';
        emptyState.style.display = 'none';
        container.innerHTML = '';

        orders.forEach((order, index) => {
            const orderCard = document.createElement('div');
            orderCard.className = 'order-card';
            
            let itemsHTML = order.items.map(item => `
                <div class="order-item">
                    <span class="item-name">${item.name}</span>
                    <span class="item-details"> ${item.quantity} Ã— CHF ${item.price.toFixed(2)}</span>
                    <span class="item-subtotal">CHF ${(item.quantity * item.price).toFixed(2)}</span>
                </div>
            `).join('');

            orderCard.innerHTML = `
                <div class="order-header">
                    <div class="order-title-section">
                        <h2>Bestellung ${index + 1}</h2>
                        <span class="order-date">${formatDate(order.date)}</span>
                    </div>
                    <span class="order-status ${order.status.toLowerCase()}">${order.status}</span>
                </div>
                <div class="order-items">
                    ${itemsHTML}
                </div>
                <div class="order-footer">
                    <span class="order-total-label">Gesamtpreis:</span>
                    <span class="order-total-price">CHF ${order.total.toFixed(2)}</span>
                </div>
            `;
            
            container.appendChild(orderCard);
        });
    }

    // Beim Laden der Seite Bestellungen anzeigen
    document.addEventListener('DOMContentLoaded', renderOrders);
</script>

{% endblock %}