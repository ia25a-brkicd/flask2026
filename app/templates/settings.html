{% extends 'base.html' %} {% block title %}Einstellungen | Flor'Avis{% endblock
%} {% block head %}
<link
  href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap"
  rel="stylesheet"
/>
<link
  href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@1,400;1,600&display=swap"
  rel="stylesheet"
/>

<link
  rel="stylesheet"
  href="{{ url_for('static', filename='styles/settings.css') }}"
/>
{% endblock %} {% block content %}
<div class="settings">
  <h1 id="title">Einstellungen</h1>

  <!-- General Section -->
  <div class="settings-section">
    <div class="section-header">
      <span class="section-icon">‚öôÔ∏è</span>
      <h2>Allgemein</h2>
    </div>

    <div class="setting-item">
      <div class="setting-info">
        <label>Sprache</label>
        <p class="setting-description">W√§hlen Sie Ihre bevorzugte Sprache</p>
      </div>
      <select class="setting-control">
        <option value="de">Deutsch</option>
        <option value="en">English</option>
        <option value="fr">Fran√ßais</option>
        <option value="it">Italiano</option>
      </select>
    </div>

    <div class="setting-item">
      <div class="setting-info">
        <label>Region / Land</label>
        <p class="setting-description">Legen Sie Ihren Standort fest</p>
      </div>
      <select class="setting-control">
        <option value="de">Deutschland</option>
        <option value="fr">Frankreich</option>
        <option value="ch">Schweiz</option>
        <option value="it">Italien</option>
        <option value="other">Sonstiges</option>
      </select>
    </div>

    <div class="setting-item">
      <div class="setting-info">
        <label>Dunkler Modus</label>
        <p class="setting-description">
          Aktivieren Sie den dunklen Modus f√ºr die Anwendung
        </p>
      </div>
      <label class="toggle-switch">
        <input type="checkbox" checked />
        <span class="slider"></span>
      </label>
    </div>
  </div>

  <!-- Notifications Section -->
  <div class="settings-section">
    <div class="section-header">
      <span class="section-icon">üîî</span>
      <h2>Benachrichtigungen</h2>
    </div>

    <div class="setting-item">
      <div class="setting-info">
        <label>Push-Benachrichtigungen</label>
        <p class="setting-description">
          Benachrichtigungen √ºber Bestellungen erhalten
        </p>
      </div>
      <label class="toggle-switch">
        <input type="checkbox" checked />
        <span class="slider"></span>
      </label>
    </div>
  </div>

  <!-- Privacy & Security Section -->
  <div class="settings-section">
    <div class="section-header">
      <span class="section-icon">üîí</span>
      <h2>Datenschutz & Sicherheit</h2>
    </div>

    <div class="setting-item">
      <div class="setting-info">
        <label>Zwei-Faktor-Authentifizierung</label>
        <p class="setting-description">Zus√§tzlicher Schutz f√ºr Ihr Konto</p>
      </div>
      <label class="toggle-switch">
        <input type="checkbox" />
        <span class="slider"></span>
      </label>
    </div>

    <div
      class="setting-item clickable"
      onclick="alert('App-Berechtigungen verwalten')"
    >
      <div class="setting-info">
        <label>App-Berechtigungen</label>
        <p class="setting-description">
          Verwalten Sie Zugriff und Berechtigungen
        </p>
      </div>
    </div>

    <div class="setting-item">
      <div class="setting-info">
        <label>Cookies</label>
        <p class="setting-description">
          Alle Cookies zulassen f√ºr besseren Schutz und Funktionalit√§t
        </p>
      </div>
      <label class="toggle-switch">
        <input type="checkbox" />
        <span class="slider"></span>
      </label>
    </div>
  </div>

  <!-- Account / Profile Section -->
  <div class="settings-section" id="konto-profil">
    <div class="section-header">
      <span class="section-icon">üë§</span>
      <h2>Konto / Profil</h2>
    </div>

    {% if request.args.get('edit') == 'adresse' %}
    <!-- Adresse Eingabe Formular -->
    <div class="contact-container">
      <div class="form-section">
        <form id="adresse-form" action="{{ url_for('settings') }}" method="post" novalidate>
          <input type="hidden" name="form_type" value="adresse" />
          <div class="input-group">
            <label for="strasse">
              <i class="fa fa-home"></i>
              Stra√üe und Hausnummer
            </label>
            <input
              type="text"
              id="strasse"
              name="strasse"
              value="{{ adresse.get('strasse', '') }}"
              placeholder="Geben Sie Ihre Stra√üe und Hausnummer ein"
              required
            />
            <span class="input-border"></span>
          </div>

          <div class="form-grid">
            <div class="input-group">
              <label for="plz">
                <i class="fa fa-map-pin"></i>
                Postleitzahl
              </label>
              <input
                type="text"
                id="plz"
                name="plz"
                value="{{ adresse.get('plz', '') }}"
                placeholder="Geben Sie Ihre Postleitzahl ein"
                inputmode="numeric"
                maxlength="4"
                pattern="\d{4}"
                title="Bitte genau 4 Ziffern eingeben"
                required
              />
              <span class="input-border"></span>
            </div>

            <div class="input-group">
              <label for="stadt">
                <i class="fa fa-city"></i>
                Stadt
              </label>
              <input
                type="text"
                id="stadt"
                name="stadt"
                value="{{ adresse.get('stadt', '') }}"
                placeholder="Geben Sie Ihre Stadt ein"
                pattern="[A-Za-z√Ñ√ñ√ú√§√∂√º√ü\s\-]+"
                title="Bitte nur Buchstaben eingeben"
                required
              />
              <span class="input-border"></span>
            </div>
          </div>

          <div class="input-group">
            <label for="land">
              <i class="fa fa-flag"></i>
              Land
            </label>
            <input
              type="text"
              id="land"
              name="land"
              value="{{ adresse.get('land', '') }}"
              placeholder="Geben Sie Ihr Land ein"
              pattern="[A-Za-z√Ñ√ñ√ú√§√∂√º√ü\s\-]+"
              title="Bitte nur Buchstaben eingeben"
              required
            />
            <span class="input-border"></span>
          </div>

          <button type="submit" class="submit-btn" id="save-adresse-btn">
            <span>Adresse speichern</span>
            <i class="fa fa-save"></i>
          </button>

          <a
            href="{{ url_for('settings') }}#konto-profil"
            class="submit-btn cancel-btn"
            id="cancel-adresse-btn"
          >
            <span>Abbrechen</span>
            <i class="fa fa-times"></i>
          </a>
        </form>
      </div>
    </div>

    {% elif request.args.get('edit') == 'versandadresse' %}
    <!-- Versandadresse Eingabe Formular -->
    <div class="contact-container">
      <div class="form-section">
        <form id="versandadresse-form" action="{{ url_for('settings') }}" method="post" novalidate>
          <input type="hidden" name="form_type" value="versandadresse" />
          <div class="input-group">
            <label for="versand_strasse">
              <i class="fa fa-home"></i>
              Stra√üe und Hausnummer
            </label>
            <input
              type="text"
              id="versand_strasse"
              name="versand_strasse"
              value="{{ versandadresse.get('strasse', '') }}"
              placeholder="Geben Sie Ihre Stra√üe und Hausnummer ein"
              required
            />
            <span class="input-border"></span>
          </div>

          <div class="form-grid">
            <div class="input-group">
              <label for="versand_plz">
                <i class="fa fa-map-pin"></i>
                Postleitzahl
              </label>
              <input
                type="text"
                id="versand_plz"
                name="versand_plz"
                value="{{ versandadresse.get('plz', '') }}"
                placeholder="Geben Sie Ihre Postleitzahl ein"
                inputmode="numeric"
                maxlength="4"
                pattern="\d{4}"
                title="Bitte genau 4 Ziffern eingeben"
                required
              />
              <span class="input-border"></span>
            </div>

            <div class="input-group">
              <label for="versand_stadt">
                <i class="fa fa-city"></i>
                Stadt
              </label>
              <input
                type="text"
                id="versand_stadt"
                name="versand_stadt"
                value="{{ versandadresse.get('stadt', '') }}"
                placeholder="Geben Sie Ihre Stadt ein"
                pattern="[A-Za-z√Ñ√ñ√ú√§√∂√º√ü\s\-]+"
                title="Bitte nur Buchstaben eingeben"
                required
              />
              <span class="input-border"></span>
            </div>
          </div>

          <div class="input-group">
            <label for="versand_land">
              <i class="fa fa-flag"></i>
              Land
            </label>
            <input
              type="text"
              id="versand_land"
              name="versand_land"
              value="{{ versandadresse.get('land', '') }}"
              placeholder="Geben Sie Ihr Land ein"
              pattern="[A-Za-z√Ñ√ñ√ú√§√∂√º√ü\s\-]+"
              title="Bitte nur Buchstaben eingeben"
              required
            />
            <span class="input-border"></span>
          </div>

          <button type="submit" class="submit-btn" id="save-versandadresse-btn">
            <span>Versandadresse speichern</span>
            <i class="fa fa-save"></i>
          </button>

          <a
            href="{{ url_for('settings') }}#konto-profil"
            class="submit-btn cancel-btn"
            id="cancel-versandadresse-btn"
          >
            <span>Abbrechen</span>
            <i class="fa fa-times"></i>
          </a>
        </form>
      </div>
    </div>

    {% else %}
    <!-- Normale Ansicht -->
    <div
      class="setting-item clickable"
      data-href="{{ url_for('settings') }}?edit=adresse#konto-profil"
    >
      <div class="setting-info">
        <label>Adresse</label>
        <p class="setting-description">
          Geben Sie ihre Adresse ein
        </p>
      </div>
      <span class="arrow">‚Ä∫</span>
    </div>

    <div class="setting-item">
      <div class="setting-info">
        <label>Versandadresse</label>
        <p class="setting-description">Versandadresse ist dieselbe, wie Adresse</p>
      </div>
      <label class="toggle-switch">
        <input type="checkbox" id="versandadresse-toggle" />
        <span class="slider"></span>
      </label>
    </div>

    <div
      id="versandadresse-item"
      class="setting-item clickable"
      data-href="{{ url_for('settings') }}?edit=versandadresse#konto-profil"
    >
      <div class="setting-info">
        <label>Versandadresse</label>
        <p class="setting-description">
          Geben Sie ihre Versandadresse ein
        </p>
      </div>
      <span class="arrow">‚Ä∫</span>
    </div>

    <div
      class="setting-item clickable danger"
      onclick="alert('Konto wird gel√∂scht')"
    >
      <div class="setting-info">
        <label>Konto l√∂schen</label>
        <p class="setting-description">Konto dauerhaft entfernen</p>
      </div>
      <span class="arrow">‚Ä∫</span>
    </div>
    {% endif %}
  </div>

  <!-- Notifications -->
  <div id="notification" class="notification success-notification {% if request.args.get('saved') == '1' %}show{% endif %}">
    <i class="fa fa-check-circle"></i>
    <div class="notification-content">
      <h4>Erfolg</h4>
      <p id="success-text">
        {% if request.args.get('saved') == '1' %}
          Deine Daten wurden erfolgreich gespeichert!
        {% else %}
          Die Daten wurden erfolgreich gespeichert!
        {% endif %}
      </p>
    </div>
  </div>

  <div id="error-notification" class="notification error-notification {% if request.args.get('saved') == '0' %}show{% endif %}">
    <i class="fa fa-exclamation-circle"></i>
    <div class="notification-content">
      <h4>Fehler</h4>
      <p id="error-text">
        {% if request.args.get('error') == 'format' %}
          Ung√ºltige Eingabe: PLZ muss genau 4 Ziffern haben, Stadt und Land d√ºrfen nur Buchstaben enthalten.
        {% elif request.args.get('saved') == '0' %}
          Speichern fehlgeschlagen. Bitte alle Pflichtfelder ausf√ºllen.
        {% else %}
          Nicht alle Felder wurden ausgef√ºllt!
        {% endif %}
      </p>
    </div>
  </div>
</div>

<script>
// Toggle Funktionalit√§t f√ºr Versandadresse
const versandadresseToggle = document.getElementById('versandadresse-toggle');
const versandadresseItem = document.getElementById('versandadresse-item');

if (versandadresseToggle && versandadresseItem) {
  versandadresseToggle.addEventListener('change', function() {
    if (this.checked) {
      versandadresseItem.classList.add('disabled');
    } else {
      versandadresseItem.classList.remove('disabled');
    }
  });
}

// Clickable items mit data-href
const clickableItems = document.querySelectorAll('.setting-item.clickable[data-href]');
clickableItems.forEach(item => {
  item.addEventListener('click', function() {
    const href = this.getAttribute('data-href');
    if (href) {
      window.location.href = href;
    }
  });
});

document.addEventListener('DOMContentLoaded', function () {
  const successNotification = document.getElementById('notification');
  const errorNotification = document.getElementById('error-notification');
  const errorText = document.getElementById('error-text');
  const adresseForm = document.getElementById('adresse-form');
  const versandadresseForm = document.getElementById('versandadresse-form');
  let errorTimeoutId = null;

  function showError(message) {
    if (!errorNotification || !errorText) {
      return;
    }

    errorText.textContent = message;
    errorNotification.classList.remove('hide');
    errorNotification.classList.add('show');

    if (errorTimeoutId !== null) {
      clearTimeout(errorTimeoutId);
    }

    errorTimeoutId = setTimeout(function () {
      errorNotification.classList.remove('show');
      errorNotification.classList.add('hide');
    }, 4000);
  }

  function getValidationMessage(field) {
    if (field.validity.valueMissing) {
      return 'Bitte alle Pflichtfelder ausf√ºllen.';
    }

    if (field.name === 'plz' || field.name === 'versand_plz') {
      return 'PLZ muss genau 4 Ziffern enthalten.';
    }

    if (field.name === 'stadt' || field.name === 'land' || field.name === 'versand_stadt' || field.name === 'versand_land') {
      return 'Stadt und Land d√ºrfen nur Buchstaben enthalten.';
    }

    return 'Bitte Eingabe pr√ºfen.';
  }

  function bindFormValidation(form) {
    if (!form) {
      return;
    }

    form.addEventListener('submit', function (event) {
      const invalidField = form.querySelector(':invalid');
      if (invalidField) {
        event.preventDefault();
        showError(getValidationMessage(invalidField));
        invalidField.focus();
      }
    });
  }

  bindFormValidation(adresseForm);
  bindFormValidation(versandadresseForm);

  if (successNotification && successNotification.classList.contains('show')) {
    setTimeout(function () {
      successNotification.classList.remove('show');
      successNotification.classList.add('hide');
    }, 4000);
  }

  if (errorNotification && errorNotification.classList.contains('show')) {
    setTimeout(function () {
      errorNotification.classList.remove('show');
      errorNotification.classList.add('hide');
    }, 4000);
  }
});
</script>
{% endblock %}
